<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <title>항해피디아</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="../static/jquery.cookie.js"></script>
    <style>
      /* 항해피디아 공통 색상 */
      :root {
        --hanghae: #ff0558;
      }

      .navbar-brand {
        width: 12vw;
      }
      .login-btn {
        color: gray;
      }
      .login-btn:hover {
        color: var(--hanghae);
      }
      .signup-btn {
        border-color: gray;
      }
      .signup-btn:hover {
        color: white;
        background-color: var(--hanghae);
      }
    </style>
  </head>

  <body>
    <nav class="navbar border-bottom">
      <div class="container-fluid">
        <div class="navbar-brand">
          <img class="img-fluid" src="../static/logo.png" alt="" href="{{ url_for('home') }}" />
        </div>
        <div class="d-flex me-4">
          <button
            type="button"
            class="btn me-2 login-btn"
            id="login-btn"
            data-bs-toggle="modal"
            data-bs-target="#loginModal"
          >
            로그인
          </button>
          <button
            type="button"
            class="btn me-2 login-btn"
            id="logout-btn"
            data-bs-toggle="modal"
            data-bs-target="#logoutModal"
          >
            로그아웃
          </button>
          <button
            type="button"
            class="btn signup-btn"
            id="signup-btn"
            data-bs-toggle="modal"
            data-bs-target="#signupModal"
          >
            회원가입
          </button>
        </div>
      </div>
    </nav>

    <!-- 로그인 모달 -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="loginModalLabel">로그인</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="userId" class="form-label">아이디</label>
                <input type="text" id="login-user-id" class="form-control" placeholder="아이디를 입력해주세요." />
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">비밀번호</label>
                <input type="password" id="login-user-pw" class="form-control" placeholder="비밀번호를 입력해주세요." />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
            <button type="button" class="btn btn-primary" onclick="login()">확인</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 회원가입 모달 -->
    <div class="modal fade" id="signupModal" tabindex="-1" aria-labelledby="signupModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="signupModalLabel">회원가입</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="userName" class="form-label">이름</label>
                <input type="text" id="sign-user-name" class="form-control" placeholder="이름을 입력해주세요." />
              </div>
              <div class="mb-3">
                <label for="userId" class="form-label">아이디</label>
                <input type="text" id="sign-user-id" class="form-control" placeholder="아이디를 입력해주세요." />
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">비밀번호</label>
                <input type="password" id="sign-password" class="form-control" placeholder="비밀번호를 입력해주세요." />
              </div>
              <div class="mb-3">
                <label for="passwordCheck" class="form-label">비밀번호 확인</label>
                <input
                  type="password"
                  id="password-check"
                  class="form-control"
                  placeholder="비밀번호를 다시 입력해주세요."
                />
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
            <button type="button" class="btn btn-primary" onclick="signup()">확인</button>
          </div>
        </div>
      </div>
    </div>

    <!-- 로그아웃 모달 -->
    <div class="modal fade" id="logoutModal" tabindex="-1" aria-labelledby="logoutModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-body">
            <div>로그아웃 하시겠습니까?</div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기</button>
            <button type="button" class="btn btn-primary" onclick="logout()">확인</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      $(function () {
        let token = $.cookie('mytoken');
        console.log('token : ', !!token);
        if (!!token) {
          $('#login-btn').hide();
          $('#signup-btn').hide();
        } else {
          $('#logout-btn').hide();
        }
      });
      // 로그인
      const login = () => {
        userId_receive = $('#login-user-id').val();
        password_receive = $('#login-password').val();

        // 유효성 검사
        if (userId_receive === '') {
          alert('아이디를 입력해주세요!');
          return;
        } else if (password_receive === '') {
          alert('비밀번호를 입력해주세요!');
          return;
        }
        $.ajax({
          type: 'POST',
          url: '/api/login',
          data: { userId: $('#login-user-id').val(), password: $('#login-user-pw').val() },
          success: function (response) {
            if (response['result'] == 'success') {
              // 로그인이 정상적으로 되면, 토큰을 받아옵니다.
              // 이 토큰을 mytoken이라는 키 값으로 쿠키에 저장합니다.
              $.cookie('mytoken', response['token']);

              window.location.href = '/';
            } else {
              // 로그인이 안되면 에러메시지를 띄웁니다.
              alert(response['msg']);
            }
          },
        });
      };

      // 회원가입
      const signup = () => {
        userName_receive = $('#sign-user-name').val();
        userId_receive = $('#sign-user-id').val();
        password_receive = $('#sign-password').val();
        password_check_receive = $('#password-check').val();

        // 유효성 검사
        if (userName_receive === '') {
          alert('이름을 입력해주세요!');
          return;
        } else if (userId_receive === '') {
          alert('아이디를 입력해주세요!');
          return;
        } else if (password_receive === '') {
          alert('비밀번호를 입력해주세요!');
          return;
        } else if (password_check_receive === '') {
          alert('비밀번호 확인을 입력해주세요!');
          return;
        } else if (password_receive !== password_check_receive) {
          alert('비밀번호가 다릅니다.');
          return;
        }
        $.ajax({
          type: 'POST',
          url: '/api/signup',
          data: {
            userName: userId_receive,
            userId: userId_receive,
            password: password_receive,
          },
          success: function (response) {
            if (response['result'] == 'success') {
              // 로그인이 정상적으로 되면, 토큰을 받아옵니다.
              // 이 토큰을 mytoken이라는 키 값으로 쿠키에 저장합니다.
              $.cookie('mytoken', response['token']);

              alert('회원가입 완료!');
              window.location.href = '/';
            } else {
              // 로그인이 안되면 에러메시지를 띄웁니다.
              alert(response['msg']);
            }
          },
        });
      };

      // 로그아웃
      const logout = () => {
        $.removeCookie('mytoken');
        window.location.href = '/';
      };
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
